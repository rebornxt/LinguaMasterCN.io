<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Learning App</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        .chinese-text {
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', sans-serif;
        }
        
        .app-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        /* Main Container */
        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        /* Header */
        .header {
            padding: 24px 32px 20px;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 4px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* Controls Section */
        .controls-section {
            padding: 24px 32px;
            border-bottom: 1px solid #e2e8f0;
            background: #f8fafc;
        }
        
        .upload-row {
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-row {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-row:last-child {
            margin-bottom: 0;
        }
        
        .control-label {
            font-weight: 600;
            color: #4a5568;
            min-width: 70px;
            font-size: 14px;
        }
        
        .btn {
            padding: 8px 14px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            color: #4a5568;
            font-weight: 500;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .btn:hover {
            border-color: #667eea;
            color: #667eea;
            transform: translateY(-1px);
        }
        
        .btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-group {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .file-input {
            display: none;
        }
        
        .upload-btn {
            background: #48bb78;
            border-color: #48bb78;
            color: white;
        }
        
        .upload-btn:hover {
            background: #38a169;
            border-color: #38a169;
            color: white;
        }
        
        /* Learning Section */
        .learning-section {
            padding: 32px;
            text-align: center;
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }
        
        /* Progress Strip */
        .progress-strip {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #e2e8f0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.8s ease;
        }
        
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            position: relative;
        }
        
        .stat-item {
            text-align: center;
            font-size: 12px;
            color: #718096;
            position: relative;
        }
        
        .stat-value {
            font-size: 16px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 2px;
        }
        
        .message-tooltip {
            position: absolute;
            top: -35px;
            right: -10px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 11px;
            font-weight: 500;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            animation: fadeInMessage 0.3s ease-out;
        }
        
        .message-tooltip.success {
            color: #2f855a;
            border-color: #9ae6b4;
            background: #f0fff4;
        }
        
        .message-tooltip.error {
            color: #c53030;
            border-color: #feb2b2;
            background: #fffafa;
        }
        
        .message-tooltip::after {
            content: '';
            position: absolute;
            bottom: -6px;
            right: 20px;
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid white;
        }
        
        .message-tooltip.success::after {
            border-top-color: #f0fff4;
        }
        
        .message-tooltip.error::after {
            border-top-color: #fffafa;
        }
        
        @keyframes fadeInMessage {
            0% { opacity: 0; transform: translateY(5px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .question-text {
            font-size: 56px;
            margin-bottom: 12px;
            color: #2d3748;
            font-weight: 500;
        }
        
        .question-pinyin {
            font-size: 20px;
            color: #718096;
            margin-bottom: 20px;
            font-style: italic;
        }
        
        .question-prompt {
            font-size: 16px;
            color: #4a5568;
            margin-bottom: 24px;
        }
        
        /* Quiz Options */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 12px;
            max-width: 500px;
            margin: 0 auto 24px;
        }
        
        .option-btn {
            padding: 16px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            color: #2d3748;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .option-btn:hover {
            border-color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .option-btn.correct {
            border-color: #48bb78;
            background: #f0fff4;
            color: #2f855a;
        }
        
        .option-btn.incorrect {
            border-color: #f56565;
            background: #fffafa;
            color: #c53030;
        }
        
        /* Flashcard */
        .flashcard {
            min-height: 250px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            transition: all 0.3s ease;
            padding: 32px;
            margin-bottom: 24px;
        }
        
        .flashcard:hover {
            border-color: #667eea;
            background: #f7fafc;
        }
        
        .flashcard-back {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .flashcard-buttons {
            display: flex;
            gap: 12px;
        }
        
        .btn-success {
            background: #48bb78;
            border-color: #48bb78;
            color: white;
            padding: 10px 20px;
        }
        
        .btn-success:hover {
            background: #38a169;
            border-color: #38a169;
            color: white;
        }
        
        .btn-danger {
            background: #f56565;
            border-color: #f56565;
            color: white;
            padding: 10px 20px;
        }
        
        .btn-danger:hover {
            background: #e53e3e;
            border-color: #e53e3e;
            color: white;
        }
        
        /* Navigation */
        .navigation {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 12px;
            align-items: center;
            padding: 0 32px 24px;
        }
        
        .nav-left {
            justify-self: start;
        }
        
        .nav-center {
            justify-self: center;
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .nav-right {
            justify-self: end;
        }
        
        .nav-btn {
            width: 44px;
            height: 44px;
            border: 1px solid #e2e8f0;
            border-radius: 50%;
            background: white;
            color: #4a5568;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .nav-btn:hover {
            border-color: #667eea;
            color: #667eea;
            transform: translateY(-1px);
        }
        
        /* Remove old message styles since we're not using them */
        
        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .loading-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid #e2e8f0;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 12px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Celebration */
        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: celebrate 0.5s ease-out;
        }
        
        @keyframes celebrate {
            0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #718096;
        }
        
        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #4a5568;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                padding: 12px;
            }
            
            .controls-section {
                padding: 20px 24px;
            }
            
            .learning-section {
                padding: 24px 20px;
                min-height: 300px;
            }
            
            .navigation {
                padding: 0 20px 20px;
            }
            
            .question-text {
                font-size: 44px;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
                max-width: 350px;
            }
            
            .control-row {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            
            .control-label {
                min-width: auto;
                margin-bottom: 4px;
                font-size: 13px;
            }
            
            .stats-bar {
                gap: 12px;
            }
            
            .upload-row {
                flex-direction: column;
                gap: 8px;
            }
            
            .message-tooltip {
                right: -5px;
                top: -32px;
                font-size: 10px;
                padding: 4px 8px;
            }
        }
        
        @media (max-width: 480px) {
            .app-container {
                padding: 8px;
            }
            
            .header {
                padding: 20px 20px 16px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .header p {
                font-size: 13px;
            }
            
            .controls-section {
                padding: 16px 20px;
            }
            
            .learning-section {
                padding: 20px 16px;
            }
            
            .navigation {
                padding: 0 16px 16px;
                grid-template-columns: 1fr 1fr 1fr;
            }
            
            .question-text {
                font-size: 36px;
            }
            
            .question-pinyin {
                font-size: 16px;
            }
            
            .btn {
                font-size: 12px;
                padding: 6px 10px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        
        const sampleData = [
            { simplified: '你好', traditional: '你好', pinyin: 'nǐ hǎo', english: 'hello', thai: 'สวัสดี' },
            { simplified: '谢谢', traditional: '謝謝', pinyin: 'xiè xiè', english: 'thank you', thai: 'ขอบคุณ' },
            { simplified: '再见', traditional: '再見', pinyin: 'zài jiàn', english: 'goodbye', thai: 'ลาก่อน' },
            { simplified: '请', traditional: '請', pinyin: 'qǐng', english: 'please', thai: 'กรุณา' },
            { simplified: '对不起', traditional: '對不起', pinyin: 'duì bù qǐ', english: 'sorry', thai: 'ขอโทษ' },
            { simplified: '水', traditional: '水', pinyin: 'shuǐ', english: 'water', thai: 'น้ำ' },
            { simplified: '吃', traditional: '吃', pinyin: 'chī', english: 'eat', thai: 'กิน' },
            { simplified: '学习', traditional: '學習', pinyin: 'xué xí', english: 'study', thai: 'เรียน' },
        ];

        const ChineseLearningApp = () => {
            // Core state
            const [vocabulary, setVocabulary] = useState(sampleData);
            const [shuffledIndices, setShuffledIndices] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [answeredQuestions, setAnsweredQuestions] = useState(new Set());
            const [masteredWords, setMasteredWords] = useState(new Set());
            const [unlearnDeck, setUnlearnDeck] = useState(new Set());
            const [studyDeck, setStudyDeck] = useState('all');
            const [streak, setStreak] = useState(0);
            const [bestStreak, setBestStreak] = useState(0);
            const [totalAnswered, setTotalAnswered] = useState(0);
            
            // UI state
            const [mode, setMode] = useState('quiz');
            const [showTraditional, setShowTraditional] = useState(false);
            const [showPinyin, setShowPinyin] = useState(true);
            const [useEnglish, setUseEnglish] = useState(true);
            const [autoAdvance, setAutoAdvance] = useState(false);
            const [showAnswer, setShowAnswer] = useState(false);
            const [selectedOption, setSelectedOption] = useState(null);
            const [options, setOptions] = useState([]);
            const [message, setMessage] = useState('');
            const [messageType, setMessageType] = useState('');
            const [cardFlipped, setCardFlipped] = useState(false);
            const [isLoading, setIsLoading] = useState(false);
            const [showCelebration, setShowCelebration] = useState(false);
            
            // Shuffle function
            const shuffleArray = (array) => {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            };
            
            // Initialize shuffled indices
            useEffect(() => {
                if (vocabulary.length > 0) {
                    const indices = Array.from({ length: vocabulary.length }, (_, i) => i);
                    setShuffledIndices(shuffleArray(indices));
                }
            }, [vocabulary]);
            
            // Get current study vocabulary
            const getCurrentVocabulary = useCallback(() => {
                if (studyDeck === 'unlearn') {
                    const unlearnIndices = Array.from(unlearnDeck);
                    return unlearnIndices.map(index => vocabulary[index]).filter(Boolean);
                }
                return shuffledIndices.map(index => vocabulary[index]).filter(Boolean);
            }, [vocabulary, studyDeck, unlearnDeck, shuffledIndices]);
            
            // Generate quiz options
            const generateOptions = useCallback(() => {
                const currentVocab = getCurrentVocabulary();
                if (currentVocab.length === 0) return [];
                
                const currentWord = currentVocab[currentIndex];
                const correctAnswer = useEnglish ? currentWord.english : currentWord.thai;
                
                const incorrectOptions = vocabulary
                    .filter(word => (useEnglish ? word.english : word.thai) !== correctAnswer)
                    .map(word => useEnglish ? word.english : word.thai)
                    .sort(() => Math.random() - 0.5)
                    .slice(0, 3);
                
                const allOptions = [correctAnswer, ...incorrectOptions]
                    .sort(() => Math.random() - 0.5);
                
                return allOptions;
            }, [getCurrentVocabulary, currentIndex, useEnglish, vocabulary]);
            
            // Initialize options when dependencies change
            useEffect(() => {
                if (mode === 'quiz') {
                    setOptions(generateOptions());
                    setSelectedOption(null);
                    setShowAnswer(false);
                }
                setCardFlipped(false);
            }, [generateOptions, mode]);
            
            // Handle quiz answer selection
            const handleAnswerSelect = (selectedAnswer) => {
                if (selectedOption !== null) return;
                
                const currentVocab = getCurrentVocabulary();
                const currentWord = currentVocab[currentIndex];
                const correctAnswer = useEnglish ? currentWord.english : currentWord.thai;
                const isCorrect = selectedAnswer === correctAnswer;
                
                const originalIndex = vocabulary.findIndex(word => 
                    word.simplified === currentWord.simplified && 
                    word.traditional === currentWord.traditional
                );
                
                setSelectedOption(selectedAnswer);
                setShowAnswer(true);
                setAnsweredQuestions(prev => new Set([...prev, originalIndex]));
                setTotalAnswered(prev => prev + 1);
                
                if (isCorrect) {
                    setScore(prev => prev + 1);
                    setStreak(prev => {
                        const newStreak = prev + 1;
                        if (newStreak > bestStreak) {
                            setBestStreak(newStreak);
                            if (newStreak >= 5 && newStreak % 5 === 0) {
                                setShowCelebration(true);
                                setTimeout(() => setShowCelebration(false), 2000);
                            }
                        }
                        return newStreak;
                    });
                    setMasteredWords(prev => new Set([...prev, originalIndex]));
                    
                    if (studyDeck === 'unlearn') {
                        setUnlearnDeck(prev => {
                            const newSet = new Set(prev);
                            newSet.delete(originalIndex);
                            return newSet;
                        });
                        setMessage('Correct! Removed from review deck');
                    } else {
                        setMessage('Correct!');
                    }
                    setMessageType('success');
                } else {
                    setStreak(0);
                    setUnlearnDeck(prev => new Set([...prev, originalIndex]));
                    setMessage('Incorrect - Added to review deck');
                    setMessageType('error');
                }
                
                if (autoAdvance) {
                    setTimeout(() => {
                        handleNext();
                    }, 1500);
                }
                
                setTimeout(() => {
                    setMessage('');
                    setMessageType('');
                }, 3000);
            };
            
            // Flashcard interaction handlers
            const handleRemembered = () => {
                const currentVocab = getCurrentVocabulary();
                const currentWord = currentVocab[currentIndex];
                const originalIndex = vocabulary.findIndex(word => 
                    word.simplified === currentWord.simplified && 
                    word.traditional === currentWord.traditional
                );
                
                setMasteredWords(prev => new Set([...prev, originalIndex]));
                setScore(prev => prev + 1);
                setTotalAnswered(prev => prev + 1);
                setStreak(prev => {
                    const newStreak = prev + 1;
                    if (newStreak > bestStreak) {
                        setBestStreak(newStreak);
                        if (newStreak >= 5 && newStreak % 5 === 0) {
                            setShowCelebration(true);
                            setTimeout(() => setShowCelebration(false), 2000);
                        }
                    }
                    return newStreak;
                });
                
                if (studyDeck === 'unlearn') {
                    setUnlearnDeck(prev => {
                        const newSet = new Set(prev);
                        newSet.delete(originalIndex);
                        return newSet;
                    });
                    setMessage('Remembered! Removed from review deck');
                } else {
                    setMessage('Remembered!');
                }
                setMessageType('success');
                setCardFlipped(false);
                
                setTimeout(() => {
                    setMessage('');
                    setMessageType('');
                    handleNext();
                }, 1000);
            };
            
            const handleReviewAgain = () => {
                const currentVocab = getCurrentVocabulary();
                const currentWord = currentVocab[currentIndex];
                const originalIndex = vocabulary.findIndex(word => 
                    word.simplified === currentWord.simplified && 
                    word.traditional === currentWord.traditional
                );
                
                setStreak(0);
                setTotalAnswered(prev => prev + 1);
                setUnlearnDeck(prev => new Set([...prev, originalIndex]));
                setMessage('Added to review deck');
                setMessageType('error');
                setCardFlipped(false);
                
                setTimeout(() => {
                    setMessage('');
                    setMessageType('');
                    handleNext();
                }, 1000);
            };
            
            // Navigation functions
            const handleNext = () => {
                const currentVocab = getCurrentVocabulary();
                if (currentVocab.length === 0) return;
                setCurrentIndex(prev => (prev + 1) % currentVocab.length);
            };
            
            const handlePrevious = () => {
                const currentVocab = getCurrentVocabulary();
                if (currentVocab.length === 0) return;
                setCurrentIndex(prev => prev === 0 ? currentVocab.length - 1 : prev - 1);
            };
            
            const handleReset = () => {
                setCurrentIndex(0);
                setScore(0);
                setAnsweredQuestions(new Set());
                setSelectedOption(null);
                setShowAnswer(false);
                setCardFlipped(false);
                setMessage('');
                setMessageType('');
                setStreak(0);
                setTotalAnswered(0);
                
                if (vocabulary.length > 0) {
                    const indices = Array.from({ length: vocabulary.length }, (_, i) => i);
                    setShuffledIndices(shuffleArray(indices));
                }
            };
            
            const handleFullReset = () => {
                handleReset();
                setMasteredWords(new Set());
                setUnlearnDeck(new Set());
                setStudyDeck('all');
                setBestStreak(0);
                
                if (vocabulary.length > 0) {
                    const indices = Array.from({ length: vocabulary.length }, (_, i) => i);
                    setShuffledIndices(shuffleArray(indices));
                }
            };
            
            // File handling
            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                setIsLoading(true);
                
                if (file.type !== 'text/csv' && !file.name.toLowerCase().endsWith('.csv')) {
                    setMessage('Please select a valid CSV file');
                    setMessageType('error');
                    setIsLoading(false);
                    return;
                }
                
                const reader = new FileReader();
                reader.onerror = () => {
                    setMessage('Error reading file');
                    setMessageType('error');
                    setIsLoading(false);
                };
                
                reader.onload = (e) => {
                    try {
                        const text = e.target.result;
                        const lines = text.split(/\r?\n/).filter(line => line.trim());
                        
                        if (lines.length < 2) {
                            setMessage('CSV file must have at least a header row and one data row');
                            setMessageType('error');
                            setIsLoading(false);
                            return;
                        }
                        
                        const parseCSVLine = (line) => {
                            const result = [];
                            let current = '';
                            let inQuotes = false;
                            
                            for (let i = 0; i < line.length; i++) {
                                const char = line[i];
                                
                                if (char === '"') {
                                    inQuotes = !inQuotes;
                                } else if (char === ',' && !inQuotes) {
                                    result.push(current.trim());
                                    current = '';
                                } else {
                                    current += char;
                                }
                            }
                            result.push(current.trim());
                            return result.map(field => field.replace(/^"(.*)"$/, '$1'));
                        };
                        
                        const headers = parseCSVLine(lines[0]).map(h => h.toLowerCase().trim());
                        const requiredHeaders = ['simplified', 'traditional', 'pinyin', 'english', 'thai'];
                        const missingHeaders = requiredHeaders.filter(h => !headers.includes(h));
                        
                        if (missingHeaders.length > 0) {
                            setMessage(`Missing required columns: ${missingHeaders.join(', ')}`);
                            setMessageType('error');
                            setIsLoading(false);
                            return;
                        }
                        
                        const data = [];
                        for (let i = 1; i < lines.length; i++) {
                            const values = parseCSVLine(lines[i]);
                            const row = {};
                            
                            headers.forEach((header, index) => {
                                row[header] = values[index] ? values[index].trim() : '';
                            });
                            
                            if (row.simplified && row.english) {
                                data.push(row);
                            }
                        }
                        
                        if (data.length === 0) {
                            setMessage('No valid vocabulary entries found in CSV');
                            setMessageType('error');
                            setIsLoading(false);
                            return;
                        }
                        
                        setVocabulary(data);
                        handleFullReset();
                        setMessage(`Successfully loaded ${data.length} vocabulary entries!`);
                        setMessageType('success');
                        
                        setTimeout(() => {
                            const indices = Array.from({ length: data.length }, (_, i) => i);
                            setShuffledIndices(shuffleArray(indices));
                            setIsLoading(false);
                        }, 100);
                        
                    } catch (error) {
                        setMessage(`Error parsing CSV file: ${error.message}`);
                        setMessageType('error');
                        setIsLoading(false);
                    }
                };
                
                reader.readAsText(file, 'UTF-8');
                event.target.value = '';
            };
            
            // Calculated values
            const currentVocab = getCurrentVocabulary();
            const currentWord = currentVocab[currentIndex] || {};
            const displayedChinese = showTraditional ? currentWord.traditional : currentWord.simplified;
            const masteryPercentage = vocabulary.length > 0 ? Math.round((masteredWords.size / vocabulary.length) * 100) : 0;
            const accuracy = totalAnswered > 0 ? Math.round((score / totalAnswered) * 100) : 0;
            
            return (
                <div className="app-container">
                    <div className="main-container">
                        {/* Header */}
                        <div className="header">
                            <h1>Chinese Learning App 中文学习应用</h1>
                            <p>Learn Chinese vocabulary with interactive flashcards and quizzes</p>
                        </div>
                        
                        {/* Controls Section */}
                        <div className="controls-section">
                            <div className="upload-row">
                                <input
                                    type="file"
                                    accept=".csv"
                                    onChange={handleFileUpload}
                                    className="file-input"
                                    id="csvFileInput"
                                    disabled={isLoading}
                                />
                                <label htmlFor="csvFileInput" className="btn upload-btn" style={{cursor: isLoading ? 'not-allowed' : 'pointer'}}>
                                    📁 {isLoading ? 'Uploading...' : 'Upload CSV'}
                                </label>
                            </div>
                            
                            <div className="control-row">
                                <span className="control-label">Study:</span>
                                <div className="btn-group">
                                    <button 
                                        className={`btn ${studyDeck === 'all' ? 'active' : ''}`}
                                        onClick={() => {
                                            setStudyDeck('all');
                                            setCurrentIndex(0);
                                            setSelectedOption(null);
                                            setShowAnswer(false);
                                            setCardFlipped(false);
                                        }}
                                    >
                                        All Words ({vocabulary.length})
                                    </button>
                                    <button 
                                        className={`btn ${studyDeck === 'unlearn' ? 'active' : ''}`}
                                        onClick={() => {
                                            setStudyDeck('unlearn');
                                            setCurrentIndex(0);
                                            setSelectedOption(null);
                                            setShowAnswer(false);
                                            setCardFlipped(false);
                                        }}
                                        disabled={unlearnDeck.size === 0}
                                    >
                                        Review Deck ({unlearnDeck.size})
                                    </button>
                                </div>
                            </div>
                            
                            <div className="control-row">
                                <span className="control-label">Mode:</span>
                                <div className="btn-group">
                                    <button 
                                        className={`btn ${mode === 'quiz' ? 'active' : ''}`}
                                        onClick={() => setMode('quiz')}
                                    >
                                        Quiz
                                    </button>
                                    <button 
                                        className={`btn ${mode === 'flashcard' ? 'active' : ''}`}
                                        onClick={() => setMode('flashcard')}
                                    >
                                        Flashcard
                                    </button>
                                </div>
                            </div>
                            
                            <div className="control-row">
                                <span className="control-label">Options:</span>
                                <div className="btn-group">
                                    <button 
                                        className={`btn ${showTraditional ? 'active' : ''}`}
                                        onClick={() => setShowTraditional(!showTraditional)}
                                    >
                                        {showTraditional ? 'Traditional' : 'Simplified'}
                                    </button>
                                    <button 
                                        className={`btn ${showPinyin ? 'active' : ''}`}
                                        onClick={() => setShowPinyin(!showPinyin)}
                                    >
                                        {showPinyin ? 'Hide Pinyin' : 'Show Pinyin'}
                                    </button>
                                    <button 
                                        className={`btn ${useEnglish ? 'active' : ''}`}
                                        onClick={() => setUseEnglish(!useEnglish)}
                                    >
                                        {useEnglish ? 'English' : 'Thai'}
                                    </button>
                                    <button 
                                        className={`btn ${autoAdvance ? 'active' : ''}`}
                                        onClick={() => setAutoAdvance(!autoAdvance)}
                                    >
                                        Auto Advance
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        {/* Learning Section */}
                        {currentVocab.length > 0 ? (
                            <div className="learning-section">
                                <div className="progress-strip">
                                    <div className="progress-fill" style={{width: `${masteryPercentage}%`}}></div>
                                </div>
                                
                                <div className="stats-bar">
                                    <div className="stat-item">
                                        <div className="stat-value">{score}</div>
                                        <div>Correct</div>
                                    </div>
                                    <div className="stat-item">
                                        <div className="stat-value">{accuracy}%</div>
                                        <div>Accuracy</div>
                                    </div>
                                    <div className="stat-item">
                                        <div className="stat-value">{streak}🔥</div>
                                        <div>Streak</div>
                                    </div>
                                    <div className="stat-item">
                                        <div className="stat-value">{masteredWords.size}</div>
                                        <div>Mastered</div>
                                        {message && (
                                            <div className={`message-tooltip ${messageType}`}>
                                                {message}
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                {mode === 'quiz' ? (
                                    <>
                                        <div className="question-text chinese-text">
                                            {displayedChinese}
                                        </div>
                                        {showPinyin && (
                                            <div className="question-pinyin">
                                                {currentWord.pinyin}
                                            </div>
                                        )}
                                        <div className="question-prompt">
                                            Select the {useEnglish ? 'English' : 'Thai'} translation:
                                        </div>
                                        
                                        <div className="options-grid">
                                            {options.map((option, index) => {
                                                const correctAnswer = useEnglish ? currentWord.english : currentWord.thai;
                                                const isCorrect = option === correctAnswer;
                                                const isSelected = selectedOption === option;
                                                
                                                let className = 'option-btn';
                                                if (showAnswer && isSelected) {
                                                    className += isCorrect ? ' correct' : ' incorrect';
                                                } else if (showAnswer && isCorrect) {
                                                    className += ' correct';
                                                }
                                                
                                                return (
                                                    <button
                                                        key={index}
                                                        className={className}
                                                        onClick={() => handleAnswerSelect(option)}
                                                        disabled={selectedOption !== null}
                                                    >
                                                        {option}
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </>
                                ) : (
                                    <div 
                                        className="flashcard"
                                        onClick={() => setCardFlipped(!cardFlipped)}
                                    >
                                        {!cardFlipped ? (
                                            <div>
                                                <div className="question-text chinese-text">
                                                    {displayedChinese}
                                                </div>
                                                {showPinyin && (
                                                    <div className="question-pinyin">
                                                        {currentWord.pinyin}
                                                    </div>
                                                )}
                                                <div className="question-prompt">
                                                    Click to reveal translation
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="flashcard-back">
                                                <div>
                                                    <div className="question-text chinese-text" style={{fontSize: '40px'}}>
                                                        {displayedChinese}
                                                    </div>
                                                    <div className="question-pinyin">
                                                        {currentWord.pinyin}
                                                    </div>
                                                    <div style={{fontSize: '18px', color: '#2d3748', fontWeight: '500'}}>
                                                        {useEnglish ? currentWord.english : currentWord.thai}
                                                    </div>
                                                </div>
                                                <div className="flashcard-buttons">
                                                    <button 
                                                        className="btn btn-danger"
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            handleReviewAgain();
                                                        }}
                                                    >
                                                        Review Again
                                                    </button>
                                                    <button 
                                                        className="btn btn-success"
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            handleRemembered();
                                                        }}
                                                    >
                                                        ✓ Remembered
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>
                        ) : vocabulary.length > 0 ? (
                            <div className="learning-section">
                                <div className="empty-state">
                                    <h3>Review Deck is Empty!</h3>
                                    <p>Great job! Switch back to "All Words" to continue learning.</p>
                                </div>
                            </div>
                        ) : (
                            <div className="learning-section">
                                <div className="empty-state">
                                    <h3>Welcome!</h3>
                                    <p>Upload your vocabulary CSV file or download the template to get started.</p>
                                </div>
                            </div>
                        )}
                        
                        {/* Navigation */}
                        {currentVocab.length > 0 && (
                            <div className="navigation">
                                <div className="nav-left">
                                    <button className="nav-btn" onClick={handlePrevious} title="Previous">
                                        ←
                                    </button>
                                </div>
                                <div className="nav-center">
                                    <button className="nav-btn" onClick={handleReset} title="Reset">
                                        ↻
                                    </button>
                                    <button className="nav-btn" onClick={handleFullReset} title="Full Reset">
                                        🗑
                                    </button>
                                </div>
                                <div className="nav-right">
                                    <button className="nav-btn" onClick={handleNext} title="Next">
                                        →
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    {/* Loading Overlay */}
                    {isLoading && (
                        <div className="loading-overlay">
                            <div className="loading-content">
                                <div className="spinner"></div>
                                <div>Processing CSV file...</div>
                            </div>
                        </div>
                    )}
                    
                    {/* Celebration */}
                    {showCelebration && (
                        <div className="celebration">
                            <h2>🎉 Great Job!</h2>
                            <p>{bestStreak} correct answers in a row!</p>
                        </div>
                    )}
                </div>
            );
        };
        
        ReactDOM.render(<ChineseLearningApp />, document.getElementById('root'));
    </script>
</body>
</html>
